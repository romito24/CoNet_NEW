# **מערכת CoNet - פלטפורמה לניהול חללי עבודה וקהילות**

ברוכים הבאים לשרת ה-Backend של מערכת CoNet.
המערכת משמשת לניהול והזמנת חללי עבודה משותפים, ניהול קהילות דיגיטליות, וארגון אירועים.
המערכת מפרידה בין הרשאות משתמשים (משתמש רגיל, מנהל קהילה, מנהל מרחב ואדמין) ומספקת ממשק ניהול הוליסטי לכל סוג משתמש.

🔗 **כתובת השרת (Production):** `https://conet.dynv6.net/`

---

## **🛠️ טכנולוגיות**

* **סביבת ריצה:** Node.js
* **פריימוורק:** Express.js
* **בסיס נתונים:** MySQL
* **אימות ואבטחה:** JWT (JSON Web Tokens) & bcrypt
* **שירות מיילים:** Nodemailer
* **יומן וזימונים:** ics (יצירת קבצי זימון ליומן הנשלחים במייל)

---

## **📦 הוראות התקנה (למפתחים)**

### **1. שכפול המאגר**
הריצו את הפקודות הבאות בטרמינל כדי להוריד את הפרויקט ולהתקין את הספריות הדרושות:

```bash
git clone <REPOSITORY_URL>
cd conet-backend
npm install




```

### **2\. הגדרת קובץ סביבה (.env)**

צרו קובץ בשם `.env` בתיקייה הראשית של הפרויקט. העתיקו לתוכו את התוכן הבא (יש לשנות את הערכים לפרטים האמיתיים שלכם):

קטע קוד

```

PORT=3000

# הגדרות בסיס נתונים

DB_HOST=localhost

DB_USER=root

DB_PASSWORD=your_password

DB_NAME=CoNet_DB

# אבטחה (מפתח חתימה לטוקנים)

JWT_SECRET=your_super_secret_key

# הגדרות אימייל (לשליחת זימונים)

EMAIL_USER=your_email@gmail.com

EMAIL_PASS=your_app_password

```

### **3\. הרצת השרת**

להרצה רגילה (פיתוח):

Bash

```

node app.js

```

להרצה בסביבת ייצור (מומלץ באמצעות PM2):

Bash

```

pm2 start app.js --name conet_backend

```

* * * * *

**📚 תיעוד API**

----------------

כל הבקשות לשרת צריכות להתבצע מול הכתובת: `https://conet.dynv6.net/`

### **1\. אימות משתמשים (Auth)**

*קובץ: `routes/auth.js`*

-   **הרשמה למערכת (`POST /api/auth/register`)**

    -   יוצר משתמש חדש, מצפין סיסמה ושומר ב-DB.

    -   **Body:** `{ "first_name": "ישראל", "last_name": "ישראלי", "email": "test@test.com", "password": "123", "phone_number": "050..." }`

-   **התחברות (`POST /api/auth/login`)**

    -   מאמת פרטים ומחזיר טוקן JWT.

    -   **Body:** `{ "email": "...", "password": "..." }`

-   **קבלת פרטי משתמש נוכחי (`GET /api/auth/me`)**

    -   מחזיר את פרטי המשתמש המחובר לפי הטוקן (כולל סוג הרשאה).

* * * * *

### **2\. ניהול הזמנות (Orders)**

*קובץ: `routes/orders.js` | דרישת אבטחה: Header Authorization*

-   **יצירת הזמנה חדשה (`POST /api/orders/create`)**

    -   מבצע ולידציה מול שעות פתיחה, בודק קיבולת פנויה בחדר, יוצר הזמנה ושולח **מייל עם זימון ליומן (.ics)**.

    -   **Body:** `{ "space_id": 1, "start_time": "...", "end_time": "...", "attendees_count": 3 }`

-   **הזמנות נכנסות - "לוח טיסות" (`GET /api/orders/incoming`)**

    -   *מיועד למנהלי מרחב בלבד.*

    -   מחזיר את כל ההזמנות העתידיות למרחבים שהמשתמש מנהל (כולל פרטי המזמין).

-   **ההזמנות שלי (`GET /api/orders/my-orders`)**

    -   מחזיר היסטוריית הזמנות של המשתמש.

-   **ביטול הזמנה (`PATCH /api/orders/:orderId/cancel`)**

    -   מבטל הזמנה ומעדכן את המלאי במרחב.

* * * * *

### **3\. אירועים (Events)**

*קובץ: `routes/events.js`*

-   **קבלת כל האירועים (`GET /api/events/all`)**

    -   משמש לתצוגה כללית ולסינון בצד לקוח (עבור "אירועים בניהולי").

-   **הרשמה לאירוע (`POST /api/events/register`)**

    -   רושם משתמש לאירוע.

-   **האירועים שלי (`GET /api/events/my-events`)**

    -   מחזיר אירועים שהמשתמש נרשם אליהם.

-   **מחיקת אירוע (`DELETE /api/events/:eventId`)**

    -   *מיועד למנהלי קהילה/אדמין בלבד.*

    -   מבצע מחיקה מלאה: מוחק את האירוע, מסיר את כל המשתתפים, ומבטל את הזמנת החדר המקושרת (משחרר את המרחב).

* * * * *

### **4\. מרחבים (Spaces)**

*קובץ: `routes/spaces.js`*

-   **חיפוש מרחבים (`POST /api/spaces/search`)**

    -   מסנן מרחבים לפי פיצ'רים (מקרן, קפה וכו').

    -   **Body:** `{ "required_facilities": [1, 2] }`

-   **הוספת מרחב חדש (`POST /api/spaces/add`)**

    -   *מיועד למנהלי מרחב.*

-   **מרחבים בניהולי (`GET /api/spaces/my-managing`)**

    -   מחזיר את המרחבים שהמשתמש הנוכחי מנהל.

-   **עריכת מרחב (`PUT /api/spaces/:id`)**

    -   עדכון פרטים (שם, כתובת, קיבולת, תיאור).

* * * * *

### **5\. קהילות (Communities)**

*קובץ: `routes/communities.js`*

-   **יצירת קהילה (`POST /api/communities`)**

    -   *מיועד למנהלי קהילה.*

-   **קהילות בניהולי (`GET /api/communities/my-managing`)**

    -   מחזיר את הקהילות שהמשתמש הנוכחי מנהל.

-   **עריכת קהילה (`PUT /api/communities/:id`)**

    -   עדכון שם, נושא ותמונה של הקהילה.

* * * * *

**📂 מבנה הפרויקט**

-------------------

-   **`public/`** - קבצי הפרונטאנד (HTML, CSS, JS) כולל הדף הראשי `Holistic_profile`.

-   **`routes/`** - מכיל את הלוגיקה של ה-API בחלוקה לנושאים (`orders`, `events`, `spaces`, `communities`, `auth`).

-   **`middleware/verifyToken.js`** - מגן על נתיבים פרטיים באמצעות בדיקת JWT.

-   **`app.js`** - קובץ ההרצה הראשי.

-   **`db.js`** - הגדרות חיבור ל-MySQL.
